<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>Robot Turtles Online</title>
  <script src="google-blockly-96162a6/blockly_compressed.js"></script>
  <script src="google-blockly-96162a6/blocks_compressed.js"></script>
  <script src="google-blockly-96162a6/msg/js/en.js"></script>

  <script src="sprite.js-master/sprite.js"></script>

  <script src="google-blockly-96162a6/generators/javascript.js"></script>
  <script src="turtle_cards.js"></script>

  <script src="parse.js"></script>

  <style>
    body {
      background-color: #b7dff4;
      font-family: sans-serif;
	  overflow: hidden;
    }
    h1 {
      font-weight: normal;
      font-size: 140%;
    }
    #attempts{
      width: 100%;
      height: 320px;
      margin: 0;
      padding: 0;
      overflow: auto;
      font-size: 15px;
      line-height: 1.3;
    }
    ol {
          padding-left: 1.8em;
        user-select:none;
    }
    #attempts li{
        padding-bottom: 10px;
    }
    #attempts li:hover{
        color: #0645AD;
        text-decoration: underline;
        cursor:pointer;
    }
    ol li:last-child{
        padding-bottom: 0px;
    }
    .inv {
	  display: none;
	  visibility: hidden;
	  width:0;
	  height:0;
	  overflow: hidden;
	  position: absolute;
	  top: -9999px;
	  left:-9999px;
	}
    .runbuttons{
      display:inline-block;
      background-color: #42d9f4;
      font-size: 16px;
	  padding: 10px;
      margin: 15px 5px;
      border-radius: 10px;
      border: 1px solid #999;
      cursor:pointer;
      user-select: none; 
    }
	textW {
	  background-color: #BF8D1A;
	  padding: 10px;
	  cursor: pointer;
	  font-size: 14px;
	}
	textI {
	  color: white;
	  background-color: #E93D39;
	  padding: 10px;
	  cursor: pointer;
	  font-size: 14px;
	}
	textC {
	  background-color: blue;
	  padding: 10px;
	  cursor: pointer;
	  color: white;
	  font-size: 14px;
	}
    textL {
	  background-color: green;
	  padding: 10px;
	  cursor: pointer;
	  color: white;
	  font-size: 14px;
	}
	select {
	  -webkit-appearance: none;
	  font-size: 16px;
      background-color: #42d9f4;
	  padding: 10px;
      margin-right: 15px;
	}
	.opaque {
	  opacity:1;
	  pointer-events: auto;
	}
	.not_opaque {
	  opacity:.4;
	  pointer-events: none;
	}
  </style>
</head>


<body>
  <!-- Formatting -->
  <center>
  <table>
	<tr>
	  <table>
        <!--<td><img src="art_assets/wall.png"></td>-->
		<td><canvas id="avatar_img" height="46" width="46"></canvas> </td><!--60/60-->
		<td> </td> <td> </td>
		<td> <canvas id="level_icon" height="60" width="60"> </canvas> <td>
	  	<td>
          <select id="target" style="cursor:pointer;">
            <option value="walls" selected="selected">Walls (Beginner)</option>
            <option value="ice">Ice (Intermediate)</option>
            <option value="crates">Crates (Advanced)</option>
          <select>
		</td>
		<td style="font-size:12px">
	      <div id="walls" class="inv"style="cursor:pointer;">
			<textW id="lvl 1-1" >1</textW>
			<textW id="lvl 1-2" >2</textW>
			<textW id="lvl 1-3" >3</textW>
			<textW id="lvl 1-4" >4</textW>
			<textW id="lvl 1-5" >5</textW>
			<textW id="lvl 1-6" >6</textW>
			<textW id="lvl 1-7" >7</textW>
			<textW id="lvl 1-8" >8</textW>
			<textW id="lvl 1-9" >9</textW>
			<textW id="lvl 1-10" >10</textW>
			<textW id="lvl 1-11" >11</textW>
			<textW id="lvl 1-12" >12</textW>
			<textW id="lvl 1-13" >13</textW>
			<textW id="lvl 1-14" >14</textW>
			<textW id="lvl 1-15" >15</textW>
			<textW id="lvl 1-16" >16</textW>
			<textW id="lvl 1-17" >17</textW>
			<textW id="lvl 1-18" >18</textW>
		  </div>
          <div id="ice" class="inv"style="cursor:pointer;">
			<textI id="lvl 2-1" >1</textI>
			<textI id="lvl 2-2" >2</textI>
			<textI id="lvl 2-3" >3</textI>
			<textI id="lvl 2-4" >4</textI>
			<textI id="lvl 2-5" >5</textI>
			<textI id="lvl 2-6" >6</textI>
			<textI id="lvl 2-7" >7</textI>
			<textI id="lvl 2-8" >8</textI>
			<textI id="lvl 2-9" >9</textI>
			<textI id="lvl 2-10" >10</textI>
			<textI id="lvl 2-11">11</textI>
			<textI id="lvl 2-12">12</textI>
			<textI id="lvl 2-13">13</textI>
			<textI id="lvl 2-14">14</textI>
			<textI id="lvl 2-15">15</textI>
			<textI id="lvl 2-16">16</textI>
		  </div>
          <div id="crates" class="inv"style="cursor:pointer;">
			<textC id="lvl 3-1" >1</textC>
			<textC id="lvl 3-2" >2</textC>
			<textC id="lvl 3-3" >3</textC>
			<textC id="lvl 3-4" >4</textC>
			<textC id="lvl 3-5" >5</textC>
			<textC id="lvl 3-6" >6</textC>
			<textC id="lvl 3-7">7</textC>
			<textC id="lvl 3-8">8</textC>
			<textC id="lvl 3-9">9</textC>
			<textC id="lvl 3-10">10</textC>
		  </div>
          <div id="loops" class="inv"style="cursor:pointer;">
			<textL id="lvl 4-1">1</textL>
			<textL id="lvl 4-2">2</textL>
			<textL id="lvl 4-3">3</textL>
			<textL id="lvl 4-4">4</textL>
			<textL id="lvl 4-5">5</textL>
			<textL id="lvl 4-6">6</textL>
			<textL id="lvl 4-7">7</textL>
			<textL id="lvl 4-8">8</textL>
			<textL id="lvl 4-9">9</textL>
		  </div>
		</td>
	  </table>
	</tr>
    <tr>
	  <table>
		<td valign="top"> 
            <table>
                <tr><td><img id="exit" src=art_assets/exit.png></td></tr>
                <tr><td>
                    <div id="attempts">

                    </div>
                </td></tr>
            </table>
          </td>
	    <td id="board" ></td>
		<td>
		  <table>
            <tr>
                <td id ="levelnumber" style="text-align:center;user-select: none; ">
                Run 1/1
                </td>
            </tr>
            <tr>
                <td>
                    <input type="checkbox" id="myCheck" checked> Autoplay
                </td>
            </tr>
		    <tr>
			  <td id="play" style="cursor:pointer;"><img src="art_assets/run_button.png"></td>
			</tr>
		    <tr>
			  <td id="playslow" style="cursor:pointer;"><img src="art_assets/walk_large.png"></td>
			</tr>
		    <tr>
			  <td id="reset" style="cursor:pointer;"><img src="art_assets/setup_large.png"></td>
			</tr>
		  </table>
		</td>
	  </table>
	</tr>
    <tr>
        <td> 
          <div class = "runbuttons" id="prevrun">
            Previous Run
          </div>
        </td>
        <td>
          <div class = "runbuttons" id="nextrun">
            Next Run
          </div>
        </td>
    </tr>
    <br>
    <tr>
        <td> 
          <div class = "runbuttons" id="prevboard" style="margin-top:0px;">
            Previous Board
          </div>
        </td>
        <td>
          <div class = "runbuttons" id="nextboard" style="margin-top:0px;">
            Next Board
          </div>
        </td>
    </tr>
    <br>
    <tr>
        <td> 
          <div class = "runbuttons" id="prevstudent" style="margin-top:0px;">
            Previous Student
          </div>
        </td>
        <td>
          <div class = "runbuttons" id="nextstudent" style="margin-top:0px;">
            Next Student
          </div>
        </td>
    </tr>
	<tr>
	  <table>
	    <td><div id="blocklyDiv" style="display:none;"></div></td>
	  </table>
	</tr>
  </center>
  </table>


 <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.1.0/jquery.min.js"></script>
    
  <!-- Select Script -->  <!-- Ivan Ivanov via StackOverflow -->
  <script>
    document
      .getElementById('target')//.getElementsByTagName('td')
      .addEventListener('change', function () {
         'use strict';
         var vis = document.querySelector('.vis'),
           target = document.getElementById(this.value);
         if (vis !== null) {
           vis.className = 'inv';
         }
         if (target !== null ) {
           target.className = 'vis';
         }
	 	 // for (var i=0; i < completed.length; i++) {
	       //document.getElementById("lvl "+completed[i]).background-color = yellow;
		 // }
      });
  </script>



  <!-- Handle Sprites -->
  <script>

	var TIMEOUT = (4 * 60) * 1000 // (seconds) * 1000
	var MOVTSPEED = 300

	var http = new XMLHttpRequest();
	var url = "/index.php";

	var level = "None";
	var inst = [];
	var old_inst = [];
	var timerId= null;
	var movtTimer= null;
	var completed = [];
	// Default or retrieve the levels unlocked associated with curr_id
    var unlocked = ["1-1"];
    var runslength = 1;
      
    var avatars_217 = ["fish(green)", "fish(yellow)", "frog(BBP)", "frog(GOP)", "frog(YBR)", "frog(YGR)",
                      "monkey(blue)", "monkey(green)", "monkey(purple)","monkey(red)","monkey(yellow)", "grasshopper"]; 
    var avatars_219 = ["bee(left)", "bee(diagonal)", "fish(purple)", "fish(red)", "frog(WBG)", "frog(YPB)",
                      "monkey(green)", "monkey(yellow)", "dragonfly" ,"grasshopper"]; 
      
    window.onload = function() {

	  // Timeout Handling
	  function sendTO() {
  	    send("T-OUT", avatar, inst, level);
	  }
	  function restartTimer() {
		if (!timerId) {
		  timerId = setTimeout(sendTO, TIMEOUT);
		} else {
	      clearTimeout(timerId);
		  timerId = setTimeout(sendTO, TIMEOUT);
		}
	  } restartTimer();

	  var get = [];
	  location.search.replace('?', '').split('&').forEach(function (val) {
    	split = val.split("=", 2);
    	get[split[0]] = split[1];
	  });

	  // Draw Avatar Image
	  var avatar = get['avatar']; //location.search.split('avatar=')[1];
	  if (!avatar)
		avatar = "question";
	  var ctx = document.getElementById("avatar_img").getContext("2d");
	  var img = new Image();
	  img.onload = function(){ctx.drawImage(img,0,0,45,45);}
	  img.src = "avatars/".concat(avatar).concat(".png");

	  // Avatar Sign-In Redirect
	  document.getElementById("avatar_img").onclick = function() {
		if (avatar != "question")
			  send("LOGOUT", avatar, inst, level);
		location.href = "/rt/turtles-teachers.html";
	  }

	  document.getElementById("exit").onclick = function() {
		send("LOGOUT", avatar, inst, level);
		location.href = "/rt/turtles-teachers.html";
	  }

	  // Send Log Entry to Server
	  function send(action, avatar, inst, lvl){
		var avatar = "avatar=".concat(avatar);
		var action = "action=".concat(action);
		var inst = "inst=".concat(inst);
		var level_ = "level=".concat(lvl);
		var room = "room=".concat(get['room']);
		var params = action
					  .concat("&").concat(inst)
					  .concat("&").concat(avatar)
					  .concat("&").concat(room)
					  .concat("&").concat(level_);
		http.open("POST", url, true);
		http.setRequestHeader("Content-type", "application/x-www-form-urlencoded");
		http.send(params);
    console.log(params);
	  }
    
      function setMaxUnlocked(stage, level) {
          for (var i = 1; i <= level; i++) {
              unlocked.push(stage + "-" + i);
          }
      }
    
      //get unlocked levels from logs
      var file = null;
      var arrLines = null;
      var max1 = 0;
      var max2 = 0;
      var max3 = 0;
      var max4 = 0;
      var parser = new LogParser();
        
      if (avatar != "question") {
        var readURL = "logs/".concat(get['room']).concat("/").concat(avatar).concat(".txt");
        http.open("GET", readURL, false);
        http.onreadystatechange = function () {
          if (http.readyState === 4) {
            if (http.status === 200 || http.status == 0) {
              file = http.responseText;
              // bookmark
              parser.parse(file);
              arrLines = file.split("\n");
              for (var i = 0; i < arrLines.length; i++) {
                var splitLine = arrLines[i].replace(/\s+/g,' ').trim().split(" ");
                if (splitLine[2] == "RUN") {
                  var unlockedLevel = splitLine[4];
                  var stage = unlockedLevel.slice(0,2); 
                  var levelIndex = parseInt(unlockedLevel.substring(2), 10);
                  switch (stage) {
                    case "1-":  
                      if (levelIndex > max1)
                        max1 = levelIndex;
                      break;
                    case "2-":
                      if (levelIndex > max2)
                        max2 = levelIndex;
                      break;
                    case "3-":
                      if (levelIndex > max3)
                        max3 = levelIndex;
                    break;
                  }
                }
              } 
              setMaxUnlocked(1, max1);
              setMaxUnlocked(2, max2);
              setMaxUnlocked(3, max3);   
              for (var i = 13; i <= 18; i++) {
                  var lvl = "1-" + i; 
                  document.getElementById("lvl "+lvl).style.visibility="hidden";
              }    
              for (var i = 11; i <= 16; i++) {
                  var lvl = "2-" + i; 
                  document.getElementById("lvl "+lvl).style.visibility="hidden";
              }
              for (var i = 7; i <= 10; i++) {
                  var lvl = "3-" + i; 
                  document.getElementById("lvl "+lvl).style.visibility="hidden";
              }
            }
          }
        }
        http.send();
      }
        
      var runnumber = 0;
	  // Draw Board
  	  var scene = sjs.Scene({w:400, h:400, parent:board, autoPause:false}); //555/556
	  //var ticker = scene.Ticker(function(){}, {tickDuration:500});
	  //ticker.run();
  	  scene.loadImages(['art_assets/board.png'], function reset() {
  	  	  var background = scene.Layer('background');
  		  var board = background.Sprite('art_assets/board.png');
  		  board.update();

	    // Level Select
	    document.getElementById("lvl 1-1").onclick=function(){level="1-1";runnumber = 0;load("1-1");};
	    document.getElementById("lvl 1-2").onclick=function(){level="1-2";runnumber = 0;load("1-2");};
	    document.getElementById("lvl 1-3").onclick=function(){level="1-3";runnumber = 0;load("1-3");};
	    document.getElementById("lvl 1-4").onclick=function(){level="1-4";runnumber = 0; load("1-4");};
	    document.getElementById("lvl 1-5").onclick=function(){level="1-5";runnumber = 0; load("1-5");};
	    document.getElementById("lvl 1-6").onclick=function(){level="1-6";runnumber = 0; load("1-6");};
	    document.getElementById("lvl 1-7").onclick=function(){level="1-7";runnumber = 0; load("1-7");};
	    document.getElementById("lvl 1-8").onclick=function(){level="1-8";runnumber = 0; load("1-8");};
	    document.getElementById("lvl 1-9").onclick=function(){level="1-9";runnumber = 0; load("1-9");};
	    document.getElementById("lvl 1-10").onclick=function(){level="1-10";runnumber = 0; load("1-10");};
	    document.getElementById("lvl 1-11").onclick=function(){level="1-11";runnumber = 0; load("1-11");};
	    document.getElementById("lvl 1-12").onclick=function(){level="1-12";runnumber = 0; load("1-12");};
	    document.getElementById("lvl 1-13").onclick=function(){level="1-13";runnumber = 0; load("1-13");};
	    document.getElementById("lvl 1-14").onclick=function(){level="1-14";runnumber = 0; load("1-14");};
	    document.getElementById("lvl 1-15").onclick=function(){level="1-15";runnumber = 0; load("1-15");};
	    document.getElementById("lvl 1-16").onclick=function(){level="1-16";runnumber = 0; load("1-16");};
	    document.getElementById("lvl 1-17").onclick=function(){level="1-17";runnumber = 0; load("1-17");};
	    document.getElementById("lvl 1-18").onclick=function(){level="1-18";runnumber = 0; load("1-18");};

	    document.getElementById("lvl 2-1").onclick=function(){level="2-1";runnumber = 0; load("2-1");};
	    document.getElementById("lvl 2-2").onclick=function(){level="2-2";runnumber = 0; load("2-2");};
	    document.getElementById("lvl 2-3").onclick=function(){level="2-3";runnumber = 0; load("2-3");};
	    document.getElementById("lvl 2-4").onclick=function(){level="2-4";runnumber = 0; load("2-4");};
	    document.getElementById("lvl 2-5").onclick=function(){level="2-5";runnumber = 0; load("2-5");};
	    document.getElementById("lvl 2-6").onclick=function(){level="2-6";runnumber = 0; load("2-6");};
	    document.getElementById("lvl 2-7").onclick=function(){level="2-7";runnumber = 0; load("2-7");};
	    document.getElementById("lvl 2-8").onclick=function(){level="2-8";runnumber = 0; load("2-8");};
	    document.getElementById("lvl 2-9").onclick=function(){level="2-9";runnumber = 0; load("2-9");};
	    document.getElementById("lvl 2-10").onclick=function(){level="2-10";runnumber = 0; load("2-10");};
	    document.getElementById("lvl 2-11").onclick=function(){level="2-11";runnumber = 0; load("2-11");};
	    document.getElementById("lvl 2-12").onclick=function(){level="2-12";runnumber = 0; load("2-12");};
	    document.getElementById("lvl 2-13").onclick=function(){level="2-13";runnumber = 0; load("2-13");};
	    document.getElementById("lvl 2-14").onclick=function(){level="2-14";runnumber = 0; load("2-14");};
	    document.getElementById("lvl 2-15").onclick=function(){level="2-15";runnumber = 0; load("2-15");};
	    document.getElementById("lvl 2-16").onclick=function(){level="2-16";runnumber = 0; load("2-16");};

	    document.getElementById("lvl 3-1").onclick=function(){level="3-1";runnumber = 0; load("3-1");};
	    document.getElementById("lvl 3-2").onclick=function(){level="3-2";runnumber = 0; load("3-2");};
	    document.getElementById("lvl 3-3").onclick=function(){level="3-3";runnumber = 0; load("3-3");};
	    document.getElementById("lvl 3-4").onclick=function(){level="3-4";runnumber = 0; load("3-4");};
	    document.getElementById("lvl 3-5").onclick=function(){level="3-5";runnumber = 0; load("3-5");};
	    document.getElementById("lvl 3-6").onclick=function(){level="3-6";runnumber = 0; load("3-6");};
	    document.getElementById("lvl 3-7").onclick=function(){level="3-7";runnumber = 0; load("3-7");};
	    document.getElementById("lvl 3-8").onclick=function(){level="3-8";runnumber = 0; load("3-8");};
	    document.getElementById("lvl 3-9").onclick=function(){level="3-9";runnumber = 0; load("3-9");};
	    document.getElementById("lvl 3-10").onclick=function(){level="3-10";runnumber = 0; load("3-10");};
          
        document.getElementById("lvl 4-1").onclick=function(){level="4-1";load("4-1");};
	    document.getElementById("lvl 4-2").onclick=function(){level="4-2";load("4-2");};
	    document.getElementById("lvl 4-3").onclick=function(){level="4-3";load("4-3");};
	    document.getElementById("lvl 4-4").onclick=function(){level="4-4";load("4-4");};
	    document.getElementById("lvl 4-5").onclick=function(){level="4-5";load("4-5");};
	    document.getElementById("lvl 4-6").onclick=function(){level="4-6";load("4-6");};
	    document.getElementById("lvl 4-7").onclick=function(){level="4-7";load("4-7");};
	    document.getElementById("lvl 4-8").onclick=function(){level="4-8";load("4-8");};
	    document.getElementById("lvl 4-9").onclick=function(){level="4-9";load("4-9");};

	    // Load Level
	    var objects = scene.Layer('objects');
	    var sprites = sjs.SpriteList();
	    var square = background.h / 4;
		var jCoord = []; crateCoord=[]; wallCoord=[]; iceCoord=[]; puddleCoord=[];
		var tCoord = [7,7];
		var t_rot = 0;
		var old_lvl;
		var collision;
		var ray = false;
        var runs = [];
        var autoplay = true;
          
          // Set locked levels to gray
        for (var i=1; i <= 18; i++) {
          var lvl = "1-" + i;
          if (!unlocked.includes(lvl)) {
            document.getElementById("lvl "+lvl).style.cursor = 'default';
            document.getElementById("lvl "+lvl).style.backgroundColor = 'gray';
          }
        }
        for (var i=1; i <= 16; i++) {
          var lvl = "2-" + i;
          if (!unlocked.includes(lvl)) {
            document.getElementById("lvl "+lvl).style.cursor = 'default';
            document.getElementById("lvl "+lvl).style.backgroundColor = 'gray';
          }
        }
        for (var i=1; i <= 10; i++) {
          var lvl = "3-" + i;
          if (!unlocked.includes(lvl)) {
            document.getElementById("lvl "+lvl).style.cursor = 'default';
            document.getElementById("lvl "+lvl).style.backgroundColor = 'gray';
          }
        }
        
        document.getElementById("prevstudent").onclick = function () {
          localStorage.setItem("board_number", level);
          var student_id = localStorage.getItem("curr_id");
          var room = student_id.slice(0,3);
          var avatar = student_id.slice(3);
          var room_array = [];
          switch (room) {
            case "217":
              room_array = avatars_217;
              break;
            case "219":
              room_array = avatars_219;
              break;
          }
          var avatar_index = room_array.indexOf(avatar); 
          if (avatar_index > -1) {
            console.log(avatar_index);
            if (avatar_index > 0){
                avatar = room_array[avatar_index-1];
                localStorage.setItem("curr_id", room+avatar);
                console.log(localStorage.curr_id);
                location.href = "/rt/turtles.html?avatar="+avatar+"&room="+room;	
            }
          } else {
            console.log("Error");
          }
		};
          
        document.getElementById("nextstudent").onclick = function () {
          localStorage.setItem("board_number", level);
          console.log(level);
          var student_id = localStorage.getItem("curr_id");
          var room = student_id.slice(0,3);
          var avatar = student_id.slice(3);
          var room_array = [];
          switch (room) {
            case "217":
              room_array = avatars_217;
              break;
            case "219":
              room_array = avatars_219;
              break;
          }
          var avatar_index = room_array.indexOf(avatar); 
          if (avatar_index > -1) {
            console.log(avatar_index);
            if (avatar_index + 1 < room_array.length){
                avatar = room_array[avatar_index+1];
                localStorage.setItem("curr_id", room+avatar);
                console.log(localStorage.curr_id);
                location.href = "/rt/turtles.html?avatar="+avatar+"&room="+room;	
            }
          } else {
            console.log("Error");
          }
		};
          

		// Load 1-1 as Initial Level if not in Quiz Mode
        // Load the highest completed level (last elm in unlocked) in Quiz Mode
        document.getElementById("walls").className = 'vis';
        level = localStorage.getItem("board_number");
        var select = level.slice(0,2); // Walls, Ice, or Crates
        switch (select) {
            case "1-":
                document.getElementById("walls").className = 'vis';
                document.getElementById("ice").className = 'inv';
                document.getElementById("crates").className = 'inv';
                // Draws the crate icon
                var img = new Image();
                var ctx = document.getElementById("level_icon").getContext("2d");
                img.onload = function(){ctx.drawImage(img,0,10,45,45);}
                img.src = "art_assets/wall.png";
                $("#target").val("walls");
                break;
            case "2-":
                document.getElementById("ice").className = 'vis';
                document.getElementById("walls").className = 'inv';
                document.getElementById("crates").className = 'inv';
                // Draws the ice icon
                var img = new Image();
                var ctx = document.getElementById("level_icon").getContext("2d");
                img.onload = function(){ctx.drawImage(img,0,10,45,45);}
                img.src = "art_assets/ice.png";
                $("#target").val("ice");
                break;
            case "3-":
                document.getElementById("crates").className = 'vis';
                document.getElementById("walls").className = 'inv';
                document.getElementById("ice").className = 'inv';
                // Draws the crate icon
                var img = new Image();
                var ctx = document.getElementById("level_icon").getContext("2d");
                img.onload = function(){ctx.drawImage(img,0,10,45,45);}
                img.src = "art_assets/crate.png";
                $("#target").val("crates");
                break;
        }
        load(level);
        
        document.getElementById("myCheck").onclick=function(){
            var checkBox = document.getElementById("myCheck");
            if (checkBox.checked == true){
              autoplay = true;
            } else {
              autoplay = false;
            }
        }
        
        function get_prev_lvl() {
            var find_prev_lvl = function () {
                var select = level.slice(0,2); // Walls, Ice, or Crates
                var prev_lvl_index = Number(level.slice(2)) - 1;
                switch (select) {
                    case "1-":
                        if (prev_lvl_index < 1) {
                            return "null";
                        }
                        break;
                    case "2-":
                        if (prev_lvl_index < 1) {
                            return "walls";
                        }
                        break;
                    case "3-":
                        if (prev_lvl_index < 1) {
                            return "ice";
                        }
                        break;
                }
                level = level.slice(0,2) + prev_lvl_index.toString();
                load(level);
                return level;
            }
            
          var prev_lvl = find_prev_lvl();
          if (prev_lvl === "ice") {
                if (unlocked.includes("2-10")) {
                    setTimeout(function() {
                        document.getElementById("ice").className = 'vis';
                        document.getElementById("walls").className = 'inv';
                        document.getElementById("crates").className = 'inv';
                        // Draws the ice icon
                        var img = new Image();
                        var ctx = document.getElementById("level_icon").getContext("2d");
                        img.onload = function(){ctx.drawImage(img,0,10,45,45);}
                        img.src = "art_assets/ice.png";
                        load("2-10");
                        level = "2-10";
                        $("#target").val("ice");}, 50);
                    }
              }

              if (prev_lvl === "walls") {
                if (unlocked.includes("1-12")) {
                    setTimeout(function() {
                        document.getElementById("walls").className = 'vis';
                        document.getElementById("ice").className = 'inv';
                        document.getElementById("crates").className = 'inv';
                        // Draws the crate icon
                        var img = new Image();
                        var ctx = document.getElementById("level_icon").getContext("2d");
                        img.onload = function(){ctx.drawImage(img,0,10,45,45);}
                        img.src = "art_assets/wall.png";
                        load("1-12");
                        level = "1-12";
                         $("#target").val("walls");}, 50);
              }}
        }
          
        function get_next_lvl() {
            var find_next_lvl = function () {
                var select = level.slice(0,2); // Walls, Ice, or Crates
                var next_lvl_index = Number(level.slice(2)) + 1;
                switch (select) {
                    case "1-":
                        if (next_lvl_index > 12) {
                            return "ice";
                        }
                        break;
                    case "2-":
                        if (next_lvl_index > 10) {
                            return "crates";
                        }
                        break;
                    case "3-":
                        if (next_lvl_index > 6) {
                            return null;
                        }
                        break;
                }
                level = level.slice(0,2) + next_lvl_index.toString();
                if (unlocked.includes(level)){
                    load(level);
                }
                return level;
            }
            
          var next_lvl = find_next_lvl();
          if (next_lvl === "ice") {
                if (unlocked.includes("2-1")) {
                    setTimeout(function() {
                        document.getElementById("ice").className = 'vis';
                        document.getElementById("walls").className = 'inv';
                        document.getElementById("crates").className = 'inv';
                        // Draws the ice icon
                        var img = new Image();
                        var ctx = document.getElementById("level_icon").getContext("2d");
                        img.onload = function(){ctx.drawImage(img,0,10,45,45);}
                        img.src = "art_assets/ice.png";
                        load("2-1");
                        level = "2-1";
                        $("#target").val("ice");}, 50);
                    }
              }

              if (next_lvl === "crates") {
                if (unlocked.includes("3-1")) {
                    setTimeout(function() {
                        document.getElementById("crates").className = 'vis';
                        document.getElementById("walls").className = 'inv';
                        document.getElementById("ice").className = 'inv';
                        // Draws the crate icon
                        var img = new Image();
                        var ctx = document.getElementById("level_icon").getContext("2d");
                        img.onload = function(){ctx.drawImage(img,0,10,45,45);}
                        img.src = "art_assets/crate.png";
                        load("3-1");
                        level = "3-1";
                         $("#target").val("crates");}, 50);
              }}
        }
                
        
		// Buttons
		document.getElementById("play").onclick = function () {
		  document.getElementById("play").setAttribute("class","not_opaque");
          $("#myCheck").attr("disabled", true);
          MOVTSPEED = 300;
		  play(sprites, 1);
		};
        document.getElementById("playslow").onclick = function () {
		  document.getElementById("playslow").setAttribute("class","not_opaque");
          $("#myCheck").attr("disabled", true);
          MOVTSPEED = 600;
		  play(sprites, 1);
		};
		document.getElementById("reset").onclick= function () {
		  load(level);
		  //document.getElementById("play").setAttribute("class","opaque");
		};
        document.getElementById("prevrun").onclick = function () {
		  if(runnumber > 0) runnumber--;
          load(level);
		};
        document.getElementById("nextrun").onclick = function () {
		  if(runnumber+1 < runslength) runnumber++;
          load(level);
		};
        document.getElementById("prevboard").onclick = function () {
          runnumber = 0;
          get_prev_lvl();
		};
        document.getElementById("nextboard").onclick = function () {
          runnumber = 0;
          get_next_lvl();
		};
        
        
        $('#attempts').on('click', '.li_run', function() {
            var li_id = this.id;
            var load_run = li_id.substring(3);
            runnumber = parseInt(load_run);
            load(level);
        });
          
		// Display Levels of Selected Difficulty
    		document.getElementById("target").onchange = function () {
    		  var img = new Image();
    		  var ctx = document.getElementById("level_icon").getContext("2d");
    		  img.onload = function(){ctx.drawImage(img,0,10,45,45);}
    		  if (this.value === "walls") {
                img.src = "art_assets/wall.png";
    			level = "1-1";
    			load("1-1");
    		  }
    		  if (this.value === "ice") {
    			img.src = "art_assets/ice.png";
                level = "2-1";
    			load("2-1");
    		  }
    		  if (this.value === "crates") {
    			img.src = "art_assets/crate.png";
                level = "3-1";
    			load("3-1");
    		  }
    		};
          
        

		// Load Sprites For Level
		function load(lvl){
		  if (!unlocked.includes(lvl)) {
            while(sprite = sprites.iterate()) {
                sprite.remove();
                sprites.remove(sprite);
              }
            $("#attempts").html("");
            $("#levelnumber").html("");
            if (old_lvl) {
                level = old_lvl;
            }
 // Set the level back to the old level user was on
		  	return; // Return without proceeding
		  }
		  if (old_lvl != lvl) {
		    Blockly.mainWorkspace.clear();
    		Blockly.Xml.domToWorkspace(document.getElementById('eventBlock'), demoWorkspace);
		  }
		  //inst = [];
		  if (old_lvl != null)
		    document.getElementById("lvl "+old_lvl).setAttribute("style","font-size:14px;");
		  document.getElementById("lvl "+lvl).setAttribute("style","font-size:35px;");
		  collision = false;
		  old_inst = [];
		  restartTimer();
		  //send("LOAD  ", avatar, inst, level);
		  // Reset Level
		  t_rot = 0; jCoord=[]; crateCoord=[]; wallCoord=[]; iceCoord=[]; puddleCoord=[];
		  tCoord = [7,7]; //77

          // Load different boards for Normal Mode and Quiz Mode
          if (localStorage.quiz_mode === "false")
    	    switch_lvl(lvl);
          else
            switch_lvl_quiz(lvl);
		  old_lvl = lvl;
		  draw();
          
          runs = [];
          var div = document.getElementById('attempts');
          $("#attempts").html("<i>List of runs:</i>");

          //please don't comment this out i need this to run the turtle LOL
          if (arrLines) {
              for (var i = 0; i < arrLines.length; i++) {
                  var splitLine = arrLines[i].replace(/\s+/g,' ').trim().split(" ");
                  if (splitLine[2] == "RUN") {
                      var unlockedLevel = splitLine[4];
                      if(unlockedLevel == lvl){
                          var splitRun = splitLine[6].split(",");
                          runs.push(splitRun);
                          runslength = runs.length;
                      }
              }}
          }
          
          var rundiv = document.getElementById('levelnumber');
          var plusone = runnumber+1;
          rundiv.innerHTML = 'Run ' + plusone + "/" + runslength;
          
        var colorAdded   = 'crimson';
        var colorSwapped = 'gold';
        var colorRemoved = 'slategray';
        var colorSame    = 'black';
        
        var ahtml = "<ol type=1>";

        for (var progression of parser.progressions) {
          if (progression.level === lvl) {
            var diffs = 0;
            var progLength = 0;
            for (var j = 0; j < progression.runs.length; j++) {
              var run = progression.runs[j];
              var colors = [];
              var printString = '';

              var colorsTemp = [];
              var printStringTemp = '';

              var removedFlag = 0;
              progLength++;
              var len = Math.max(run.cardsBefore.length, run.cards.length, run.cardsAfter.length);
              for (var i = 0; i < len; i++) {

                removedFlag = 0;
                /// See what cards were REMOVED.
                if (run.cardsBefore[i] !== '_' && run.cardsBefore[i] != null) {
                  colors.push(colorRemoved);
                  printString += run.cardsBefore[i];
                  removedFlag = 1;
                  diffs++;
                }

                /// See what cards were ADDED.
                if (run.cardsAfter[i] === run.cards[i] && run.cardsAfter[i] != null) {
                  colorsTemp.push(colorAdded);
                  printStringTemp += run.cardsAfter[i];
                  diffs++;
                }
                
                /// See what cards are THE SAME.
                else if (run.cards[i] != null) {
                  colors.push(colorSame);
                  printString += run.cards[i];
                }

                if (removedFlag === 0 || i === len - 1) {
                  for (var color of colorsTemp)      colors.push(color);
                  for (var char  of printStringTemp) printString += char;
                  colorsTemp = [];
                  printStringTemp = '';
                }
              } 
              var formattedString = '';
              for (var i = 0; i < printString.length; i++) {
                formattedString += '<font color="' + colors[i] + '">' + printString[i] + '</font>';
              }

              var timeString = ' (' + run.timeTaken + ' sec)';
              
              var jplusone = j + 1;
                
              if (formattedString == ''){
                  ahtml += '<li class=li_run id = run'+ j +'>[No cards]<br>' + timeString + '</li>';
              } else {
                  ahtml += '<li class=li_run id = run'+ j +'>' + formattedString + '<br>' + run.cards + '<br>' + timeString + '</li>';
              }
                
              //$("#attempts").append( "<br> <code>" + run.cardsAfter  + "</code> <br>");
            }
            ahtml += '</ol>';
            $("#attempts").append(ahtml);
            $("#attempts").append( "<i> Summary: </i>");
            $("#attempts").append( "<br> Result: "            + progression.status);
            $("#attempts").append( "<br> Time taken: "        + progression.totalTime + " sec");
            $("#attempts").append( "<br> Average diffs: "     + ((diffs * 1.0)/(progLength * 1.0)).toPrecision(6));
            $("#attempts").append( "<br>");
            ahtml = '<ol type=1>';
          }
        }
         
		}

		function draw(){
		  // Clear Board
	      while(sprite = sprites.iterate()) {
		    sprite.remove();
		    sprites.remove(sprite);
		  }
		  // Add Sprites to Board
		  sprites.add( objects.Sprite('art_assets/jewel_light_red.png',
			{x: square*(jCoord[0]-4), y: square*(jCoord[1]-4), size:[100,100]}) );
		  for (var i = 0; i < crateCoord.length; i++) {
			sprites.add( objects.Sprite('art_assets/crate.png',
			  {x: square*(crateCoord[i][0]-4), y: square*(crateCoord[i][1]-4), size:[100,100]}) );
		  }
		  for (var i = 0; i < wallCoord.length; i++) {
			sprites.add( objects.Sprite('art_assets/wall.png',
			  {x: square*(wallCoord[i][0]-4), y: square*(wallCoord[i][1]-4), size:[100,100]}) );
		  }
		  for (var i = 0; i < iceCoord.length; i++) {
			sprites.add( objects.Sprite('art_assets/ice.png',
			  {x: square*(iceCoord[i][0]-4), y: square*(iceCoord[i][1]-4), size:[100,100]}) );
		  }
		  for (var i = 0; i < puddleCoord.length; i++) {
			sprites.add( objects.Sprite('art_assets/puddle.png',
			  {x: square*(puddleCoord[i][0]-4), y: square*(puddleCoord[i][1]-4), size:[100,100]}) );
		  }
		  sprites.add( objects.Sprite('art_assets/red.png', // turtle
		    {x: square*(tCoord[0]-4), y: square*(tCoord[1]-4), size:[100,100], angle:(Math.PI/180)*t_rot}) );
		  if (ray)
			sprites.add( objects.Sprite('art_assets/ray.png',
		      {x: square*(tCoord[0]-4), y: square*(tCoord[1]-4), size:[100,100], angle:(Math.PI/180)*t_rot}) );

	      // Draw Board
	      while(sprite = sprites.iterate()) { sprite.update(); }
		}

		function wait() {
		  var oldT = new Date().getTime();
		  var newT;
		  while ((newT = new Date().getTime()) - oldT < 1000) {
		  }
		  console.log("Finished Waiting");
		}

		// Execute Instruction Queue
		function play(s_list, bug) {
          // if (collision)
          //   return;

		  var t = -1 * MOVTSPEED;
		  if (tCoord[0]!=7 || tCoord[1]!=7)
			t += MOVTSPEED;

          load(level);

		  var seq = Blockly.JavaScript.workspaceToCode(
						Blockly.getMainWorkspace());
		  eval(seq);
		  send("RUN      ", avatar, inst, level);
		  // Avoid Unattached Cards
		  while (inst[0] != "event") inst.shift();
		  // Avoid Previous Instructions
		  var i = 0;
		  var temp_inst = [];
		  /*while (old_inst[i] && inst[i] && old_inst[i]===inst[i]) {
			i++;
		  }
		  for (i; i < inst.length; i++)
			temp_inst.push(inst[i]);
		  if (old_inst.length === 0)
			temp_inst = inst;
		  old_inst = [];
		  for (var i=0; i < inst.length; i++) {
		    old_inst[i] = inst[i];
		  }
		  inst = [];*/
          temp_inst = runs[runnumber];
		  // Interpret Instructions
		  setTimeout(function() {draw();}, 0);
		  for (var i = 0; i < temp_inst.length; i++) {
		    if (temp_inst[i] === "move")  {
			  setTimeout(function() {
				if(!collision)
    		      move (s_list);
			    draw();
                        }, t += MOVTSPEED * bug);
			}
			if (temp_inst[i] === "left") {
			  setTimeout(function() {
				if(!collision)
			      left (s_list);
			    draw();
                        }, t += MOVTSPEED * bug);
			}
			if (temp_inst[i] === "right") {
			  setTimeout(function() {
				if(!collision)
			      right (s_list);
			    draw();
                        }, t += MOVTSPEED * bug);
			}
			if (temp_inst[i] === "laser") {
			  setTimeout(function() {
				if(!collision) {
				  ray = true;
			      laser (s_list);
				}
			    draw();
				ray = false;
                        }, t += MOVTSPEED * bug);
			}
		  }
		  setTimeout(function() {
		  	document.getElementById("play").setAttribute("class","opaque");
            document.getElementById("playslow").setAttribute("class","opaque");
			}, t += MOVTSPEED * bug);
		// Did Turtle Land on Jewel?
		  t -= MOVTSPEED / 2;
		  setTimeout(function() {
            var reload_time = 0;
            if (!collision) {
                reload_time = 1000;
                jewelDetection (s_list);
            }
		    draw();
            setTimeout(function() {
                load(level);
                $("#myCheck").removeAttr("disabled");
            }, reload_time);
                     }, t += MOVTSPEED * bug);
          if ((autoplay == true) && (runnumber+1 < runslength)) {
              runnumber++;
          }
		}

		function jewelDetection(s_list) {
		  // Jewel Detection
		  setTimeout(function(){
		    if (tCoord[0] === jCoord[0] && tCoord[1] === jCoord[1]){ // Win cond.
		      // Pop-up timed after turtle's victory dance

			  var t = 0;
			  var i = 0;
			  for (i = 0; i<24; i++){
			    setTimeout(function() {
			      t_rot += 15;
			      draw();
                          }, t += 30);
			  }
			  completed.unshift(level);
			  // console.log(completed);
			  send("COMPLETE ", avatar, inst, level);
              return true;
            } else return false;
          }, 0);
		}
          
    
		function goBack(oldC, old_rot) {
		  tCoord[0] = oldC[0];
		  tCoord[1] = oldC[1]; // Reset coordinates
          t_rot = old_rot; // Reset orientation
		}

		function move(s_list) {
		  var oldC = [tCoord[0], tCoord[1]];
          var old_rot = t_rot;
		  if (t_rot === 0)   tCoord[1] -= 1;
		  if (t_rot === 90)  tCoord[0] += 1;
		  if (t_rot === 180) tCoord[1] += 1;
		  if (t_rot === 270) tCoord[0] -= 1;
		  // Collision Detection
 		  for (var i = 0; i < wallCoord.length; i++) // Wall Collision
		    if (tCoord[0] === wallCoord[i][0] && tCoord[1] === wallCoord[i][1])
		      {alert("\n\n\nOuch! I hit a wall!");collision=true; goBack(oldC, old_rot); 
               setTimeout(function() {
                    var plusone = runnumber + 1;
                    $("#levelnumber").html('Run ' + plusone + "/" + runslength);
                }, 0);
               return;}

		  for (var i = 0; i < iceCoord.length; i++) // Ice Collision
		    if (tCoord[0] === iceCoord[i][0] && tCoord[1] === iceCoord[i][1])
		      {alert("\n\n\nOuch! I hit a wall!");collision=true; goBack(oldC, old_rot); return;}

		  for (var i = 0; i < crateCoord.length; i++) { // Crate Handling
		    if (tCoord[0] === crateCoord[i][0] && tCoord[1] === crateCoord[i][1]) {//coll.
			  if (t_rot === 0)   var empty = [tCoord[0], tCoord[1]-1];
			  if (t_rot === 90)  var empty = [tCoord[0]+1, tCoord[1]];
			  if (t_rot === 180) var empty = [tCoord[0], tCoord[1]+1];
			  if (t_rot === 270) var empty = [tCoord[0]-1, tCoord[1]];
			  var obs = wallCoord.concat(crateCoord).concat(iceCoord);
			  obs.push([jCoord[0], jCoord[1]]);
		      for (var j = 0; j < obs.length; j++) // Can crate be pushed?
			    if (empty[0] === obs[j][0] && empty[1] === obs[j][1])
			      {alert("\n\n\nOops! I can't push that!");collision=true; goBack(oldC, old_rot); return;}
              if (empty[0] < 4 || empty[0] > 7 || empty[1] < 4 || empty[1] > 7)
                  {alert("\n\n\nOops! I can't push that!");collision=true; goBack(oldC, old_rot); return;}
			  crateCoord[i][0] = empty[0];
			  crateCoord[i][1] = empty[1];
			}
		  }
		  // Bounds Handling
		  if (tCoord[0] < 4 || tCoord[1] < 4 || tCoord[0] > 7 || tCoord[1] > 7)
			{alert("\n\n\nAaah! I fell off the board!");collision=true; goBack(oldC, old_rot); return;}
		}
		function left(s_list) {
		  t_rot = (t_rot + 270) % 360;
		}
		function right(s_list) {
		  t_rot = (t_rot + 90) % 360;
		}
		function laser(s_list) {
		  // Get Lasered Locations
		  var locs = [];
		  var coord;
		  if (t_rot === 0)
			for (var i = tCoord[1]; i >= 0; i--)
				locs.push( {x: tCoord[0], y: i} );
		  if (t_rot === 90)
			for (var i = tCoord[0]; i <= 7; i++)
				locs.push({x: i, y: tCoord[1]});
		  if (t_rot === 180)
			for (var i = tCoord[1]; i <= 7; i++)
				locs.push({x: tCoord[0], y: i});
		  if (t_rot === 270)
			for (var i = tCoord[0]; i >= 0; i--)
				locs.push({x: i, y: tCoord[1]});
		  // Check Locations
		  var loc;
		  var done = false;
		  while((loc = locs.shift()) && !done) {
		    if (loc.x === jCoord[0] && loc.y === jCoord[1]) // Jewel C
			  done = true;
 		    for (var i = 0; i < wallCoord.length; i++) // Wall Collision
		      if (loc.x === wallCoord[i][0] && loc.y === wallCoord[i][1])
				done = true;
 		    for (var i = 0; i < crateCoord.length; i++) // Crate Collision
		      if (loc.x === crateCoord[i][0] && loc.y === crateCoord[i][1])
				done = true;
 		    for (var i = 0; i < iceCoord.length; i++) // Ice Melt
		      if (loc.x === iceCoord[i][0] && loc.y === iceCoord[i][1]) {
				puddleCoord.push([iceCoord[i][0], iceCoord[i][1]]);
				iceCoord.splice(i,1);
				done = true;
			  }
		  }
		}

        // Set location of Jewel and obstacles for Normal Mode
		function switch_lvl(lvl) {
          switch (lvl) {
            case "0-0":
              break;
                  
            // Walls
            case "1-1":
              /* Board Modifications: delete the first line below and uncomment the second */
              // jCoord = [7,5]; // Normal Mode board
              jCoord = [7,4]; // Quiz mode board
              break;
            case "1-2":
              jCoord = [5,7];
              break;
            case "1-3":
              jCoord = [4,6];
              wallCoord.splice(0,0, [5,7], [6,5]);
              break;
            case "1-4":
              jCoord = [4,7];
              wallCoord.splice(0,0, [6,7], [4,5]);
              break;
            case "1-5":
              jCoord = [5,5];
              wallCoord.splice(0,0, [6,6], [7,5], [4,7]);
              break;
            case "1-6":
              jCoord = [6,5];
              wallCoord.splice(0,0, [4,7], [6,6], [7,5]);
              break;
            case "1-7":
              jCoord = [7,5];
              wallCoord.splice(0,0, [6,6], [7,6], [6,5]);
              break;
            case "1-8":
              jCoord = [6,4];
              wallCoord.splice(0,0, [5,7], [6,5], [7,4]);
              break;
            case "1-9":
              jCoord = [4,5];
              wallCoord.splice(0,0, [5,7], [7,5], [5,5], [4,6]);
              break;
            case "1-10":
              jCoord = [5,4];
              wallCoord.splice(0,0, [5,7], [5,5], [6,4], [7,6]);
              break;
            case "1-11":
              jCoord = [6,4];
              wallCoord.splice(0,0, [5,5], [6,6], [7,6], [4,7]);
              break;
            case "1-12":
              jCoord = [4,4];
              wallCoord.splice(0,0, [6,7], [5,6], [6,4], [7,5], [4,5]);
              break;
            
            // Ice
            case "2-1":
              jCoord = [7,4];
              wallCoord.splice(0,0, [6,7]);
              iceCoord.splice(0,0, [7,6]);
              break;
            case "2-2":
              jCoord = [5,5];
              wallCoord.splice(0,0, [6,6]);
              iceCoord.splice(0,0, [6,5], [5,6], [5,7]);
              break;
            case "2-3":
              jCoord = [6,5];
              iceCoord.splice(0,0, [7,5], [7,6], [6,6]);
              wallCoord.splice(0,0, [5,5]);
              break;
            case "2-4":
              jCoord = [4,4];
              iceCoord.splice(0,0, [5,5], [6,6]);
              wallCoord.splice(0,0, [6,7], [6,4]);
              break;
            case "2-5":
              jCoord = [5,5];
              iceCoord.splice(0,0, [5,7], [6,6], [7,5]);
              wallCoord.splice(0,0, [7,6], [5,6]);
              break;
            case "2-6":
              jCoord = [5,7];
              iceCoord.splice(0,0, [5,6], [7,6], [6,5]);
              wallCoord.splice(0,0, [6,7], [6,6]);
              break;
            case "2-7":
              jCoord = [4,5];
              iceCoord.splice(0,0, [6,5], [5,5], [5,6]);
              wallCoord.splice(0,0, [6,7], [7,5], [4,6]);
              break;
            case "2-8":
              jCoord = [4,6];
              iceCoord.splice(0,0, [5,7], [7,5], [5,5]);
              wallCoord.splice(0,0, [6,6], [6,7], [4,5]);
              break;
            case "2-9":
              jCoord = [5,4];
              iceCoord.splice(0,0, [5,6], [6,6], [7,6]);
              wallCoord.splice(0,0, [4,4], [7,4], [6,7], [6,5]);
              break;
            case "2-10":
              jCoord = [4,4];
              iceCoord.splice(0,0, [7,6], [6,5], [5,4]);
              wallCoord.splice(0,0, [6,7], [6,6], [7,4], [4,5]);
              break;

            // Crates
            case "3-1":
              jCoord = [6,5];
              wallCoord.splice(0,0, [6,7]);
              crateCoord.splice(0,0, [7,6], [6,6]);
              break;
            case "3-2":
              jCoord = [5,6];
              crateCoord.splice(0,0, [6,7], [7,6]);
              wallCoord.splice(0,0, [4,7], [6,6]);
              break;
            case "3-3":
              jCoord = [5,5];
              crateCoord.splice(0,0, [5,6], [6,5], [4,5]);
              iceCoord.splice(0,0, [6,6], [5,7], [7,6]);
              break;
            case "3-4":
              jCoord = [4,5];
              iceCoord.splice(0,0, [6,7], [5,5], [6,4]);
              wallCoord.splice(0,0, [4,7], [5,6], [6,6]);
              crateCoord.splice(0,0, [7,6]);
              break;
            case "3-5":
              jCoord = [4,4];
              iceCoord.splice(0,0, [5,4], [6,4], [5,6]);
              wallCoord.splice(0,0, [5,7], [6,6]);
              crateCoord.splice(0,0, [5,5], [7,6]);
              break;
            case "3-6":
              jCoord = [6,4];
              iceCoord.splice(0,0, [7,6], [5,5]);
              wallCoord.splice(0,0, [7,5], [5,7]);
              crateCoord.splice(0,0, [6,6], [6,5]);
              break;
            
            //Loops
            //case "4-1":
              //jCoord = [5,7];
              //iceCoord.splice(0,0, [4,4], [7,4]);
              //wallCoord.splice(0,0, [5,5], [6,5], [6,6], [6,7]);
              //break;
            
          }
		}

        /* Instructions for Board Modifications
        Ex 1. if I would like the Jewel to appear at the upper-left corner of the board
            for level 1-1
            in case "1-1", change the jCoord line to jCoord = [4,4];
        Ex 2. if I would like another wall to be added to the board
            for level 1-4
            in case "1-4", add the new coord to the wallCoord line
        General:
        - upper-left: [4,4]; lower-right: [7,7];
        - to change Jewel location, set jCoord = [x,y];
        - to change, add or remove obstacle, set wallCoord.splice(0,0, [x1,y1], [x2,y2]);
        */
        // Set location of Jewel and obstacles for Quiz Mode
        function switch_lvl_quiz(lvl) {
          switch (lvl) {
            // Walls
            case "1-1":
              /* Board Modifications: delete the first line below and uncomment the second */
              // jCoord = [7,5]; // Normal Mode board
              jCoord = [7,4]; // Quiz mode board
              break;
            case "1-2":
              jCoord = [5,7];
              break;
            case "1-3":
              jCoord = [4,6];
              wallCoord.splice(0,0, [5,7], [6,5]);
              break;
            case "1-4":
              jCoord = [4,7];
              wallCoord.splice(0,0, [6,7], [4,5]);
              break;
            case "1-5":
              jCoord = [5,5];
              wallCoord.splice(0,0, [6,6], [7,5], [4,7]);
              break;
            case "1-6":
              jCoord = [6,5];
              wallCoord.splice(0,0, [4,7], [6,6], [7,5]);
              break;
            case "1-7":
              jCoord = [7,5];
              wallCoord.splice(0,0, [6,6], [7,6], [6,5]);
              break;
            case "1-8":
              jCoord = [6,4];
              wallCoord.splice(0,0, [5,7], [6,5], [7,4]);
              break;
            case "1-9":
              jCoord = [4,5];
              wallCoord.splice(0,0, [5,7], [7,5], [5,5], [4,6]);
              break;
            case "1-10":
              jCoord = [5,4];
              wallCoord.splice(0,0, [5,7], [5,5], [6,4], [7,6]);
              break;
            case "1-11":
              jCoord = [6,4];
              wallCoord.splice(0,0, [5,5], [6,6], [7,6], [4,7]);
              break;
            case "1-12":
              jCoord = [4,4];
              wallCoord.splice(0,0, [6,7], [5,6], [6,4], [7,5], [4,5]);
              break;
            
            // Ice
            case "2-1":
              jCoord = [7,4];
              wallCoord.splice(0,0, [6,7]);
              iceCoord.splice(0,0, [7,6]);
              break;
            case "2-2":
              jCoord = [5,5];
              wallCoord.splice(0,0, [6,6]);
              iceCoord.splice(0,0, [6,5], [5,6], [5,7]);
              break;
            case "2-3":
              jCoord = [6,5];
              iceCoord.splice(0,0, [7,5], [7,6], [6,6]);
              wallCoord.splice(0,0, [5,5]);
              break;
            case "2-4":
              jCoord = [4,4];
              iceCoord.splice(0,0, [5,5], [6,6]);
              wallCoord.splice(0,0, [6,7], [6,4]);
              break;
            case "2-5":
              jCoord = [5,5];
              iceCoord.splice(0,0, [5,7], [6,6], [7,5]);
              wallCoord.splice(0,0, [7,6], [5,6]);
              break;
            case "2-6":
              jCoord = [5,7];
              iceCoord.splice(0,0, [5,6], [7,6], [6,5]);
              wallCoord.splice(0,0, [6,7], [6,6]);
              break;
            case "2-7":
              jCoord = [4,5];
              iceCoord.splice(0,0, [6,5], [5,5], [5,6]);
              wallCoord.splice(0,0, [6,7], [7,5], [4,6]);
              break;
            case "2-8":
              jCoord = [4,6];
              iceCoord.splice(0,0, [5,7], [7,5], [5,5]);
              wallCoord.splice(0,0, [6,6], [6,7], [4,5]);
              break;
            case "2-9":
              jCoord = [5,4];
              iceCoord.splice(0,0, [5,6], [6,6], [7,6]);
              wallCoord.splice(0,0, [4,4], [7,4], [6,7], [6,5]);
              break;
            case "2-10":
              jCoord = [4,4];
              iceCoord.splice(0,0, [7,6], [6,5], [5,4]);
              wallCoord.splice(0,0, [6,7], [6,6], [7,4], [4,5]);
              break;

            // Crates
            case "3-1":
              jCoord = [6,5];
              wallCoord.splice(0,0, [6,7]);
              crateCoord.splice(0,0, [7,6], [6,6]);
              break;
            case "3-2":
              jCoord = [5,6];
              crateCoord.splice(0,0, [6,7], [7,6]);
              wallCoord.splice(0,0, [4,7], [6,6]);
              break;
            case "3-3":
              jCoord = [5,5];
              crateCoord.splice(0,0, [5,6], [6,5], [4,5]);
              iceCoord.splice(0,0, [6,6], [5,7], [7,6]);
              break;
            case "3-4":
              jCoord = [4,5];
              iceCoord.splice(0,0, [6,7], [5,5], [6,4]);
              wallCoord.splice(0,0, [4,7], [5,6], [6,6]);
              crateCoord.splice(0,0, [7,6]);
              break;
            case "3-5":
              jCoord = [4,4];
              iceCoord.splice(0,0, [5,4], [6,4], [5,6]);
              wallCoord.splice(0,0, [5,7], [6,6]);
              crateCoord.splice(0,0, [5,5], [7,6]);
              break;
            case "3-6":
              jCoord = [6,4];
              iceCoord.splice(0,0, [7,6], [5,5]);
              wallCoord.splice(0,0, [7,5], [5,7]);
              crateCoord.splice(0,0, [6,6], [6,5]);
              break;
            
            //Loops
            //case "4-1":
              //jCoord = [5,7];
              //iceCoord.splice(0,0, [4,4], [7,4]);
              //wallCoord.splice(0,0, [5,5], [6,5], [6,6], [6,7]);
              //break;
            
          }
        }
	  });
    }

  </script>

  <!-- Blockly Blocks -->
  <xml id="toolbox" style="display: none">
    <block type="move"></block>
    <block type="left"></block>
    <block type="right"></block>
    <block type="laser"></block>
  </xml>
  <xml id="eventBlock" style="display: none">
    <block type="event" movable="false" x="-1325" y="143"></block>
  </xml>

  <!-- Blockly Script -->
  <script>
    var demoWorkspace = Blockly.inject('blocklyDiv',
        {
		 horizontalLayout: true,
		 trashcan: true,
         toolbox: document.getElementById('toolbox')});
    Blockly.Xml.domToWorkspace(document.getElementById('eventBlock'), demoWorkspace);
  </script>

</body>
</html>
